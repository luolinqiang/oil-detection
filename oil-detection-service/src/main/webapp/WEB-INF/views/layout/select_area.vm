<!-- 选择地区dialog start -->
<div class="am-modal am-modal-confirm" tabindex="-1" id="___select-area-dialog" >
    <div class="am-modal-dialog">
        <div class="am-modal-hd" style="text-align:left;font-size:1rem;" id="___area_back_div">
            <h2>&nbsp;</h2>
        </div>
        <div id="____area_scroll" class="am-modal-bd" style="height:30rem;overflow-y:scroll;">
            <div data-am-widget="list_news" class="am-list-news am-list-news-default am-list-news-bd" style="margin:0;">
                <ul class="am-list" id="___area-list-div"></ul>
            </div>
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn" data-am-modal-cancel>取消</span>
        </div>
    </div>
</div>
<!-- 选择地区dialog end -->
<script type="text/javascript">
    var ____area = [];
    var ____onSelectAreaCallback;
    function selectArea(onEnsure,onCancel){
        ____area = []
        ____onSelectAreaCallback = onEnsure;
        var props = {
            relatedTarget : this
        }
        if(onCancel){
            props.onCancel = onCancel
        }
        ___loadArea();
        $('#___select-area-dialog').modal(props);

    }
    function ___loadArea(pid,name){
        var str = '';
        if(pid){
            str = '?pid=' + pid;
            if(name){
                ____area.push({id : pid,name : name});
            }
        }
        $('#___area_back_div').html('<h2>&nbsp;</h2>');
        $('#___area-list-div').html('<li class="am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left">加载中...</li>');
        $.ajax({
            url : Wei.up + '/area-list' + Wei.us + str,
            dataType : 'json',
            success : function(data){
                $('#___area-list-div').html('');
                if(data.success){
                    if(data.pid != undefined){
                        $('#___area_back_div').html('<h2 onclick="___loadArea(' + data.pid + ')">< &nbsp;返回</h2>');
                    }else{
                        $('#___area_back_div').html('<h2>&nbsp;</h2>');
                    }
                    var html = '';
                    for(var i = 0;i < data.result.length;i++){
                        var area = data.result[i];
                        if(area.hasChildren){
                            html += '<li onclick="___loadArea(' + area.id + ',\'' + area.name + '\')" class="am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left"><div class="am-u-sm-10 am-list-main"><div class="am-list-item-text">' + area.name + '</div></div><div class="am-u-sm-2 am-list-main"><div class="am-list-item-text">></div></div></li>';
                        }else{
                            html += '<li onclick="___selectArea(' + area.id + ',\'' + area.name + '\')" class="am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left"><div class="am-u-sm-10 am-list-main"><div class="am-list-item-text">' + area.name + '</div></div><div class="am-u-sm-2 am-list-main"><div class="am-list-item-text"></div></div></li>';
                        }
                    }
                    $('#___area-list-div').html(html);
                }
            },
            error : function(){
                $('#___area-list-div').html('');
            }
        });
    }
    function ___selectArea(id,name){
        if(name){
            ____area.push({id : id,name : name});
        }
        $.ajax({
            url : Wei.up + '/area-name' + Wei.us + '?id=' + id,
            dataType : 'json',
            success : function(data){
                if(data.success){
                    $('#___select-area-dialog').modal('close');
                    if(____onSelectAreaCallback){
                        ____onSelectAreaCallback(data.result,____area);
                    }
                }
            }
        });
    }
</script>